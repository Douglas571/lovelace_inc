<h1>Registra un nuevo art√≠culo!! Hay {{ length }}</h1>

<div>
  <h1>Crear un nuevo articulo:</h1>
  <form id="newArticle">
    <label>Nombre</label>
    <input type="field" name="name" value="Sandalias">
    </br>
    <label>Precio</label>
    <input type="field" name="price" value="100">
    </br>
    <label>En Venta</label>
    <input type="field" name="stock" value="10">
    </br>
    <label>Foto</label>
    <input type="file" id="files" multiple="true" name="photo">
    </br>
    <div id="previews">
      
    </div>
    <div>
      <label>Disponible</label>
      <input type="checkbox" name="available">
    </div>
    <input type="submit" name="send">
  </form>
</div>

{{#each articles}}
  {{> article}}
{{/each}}
<script type="text/javascript">
  console.log('ejecutando...');

  const articulo = {
    id: new Date(),
    name: 'Sandalias',
    price: 100,
    stock: 20,
    photo: 'path to photo'
  }

  let form = document.getElementById('newArticle')
  let fileInput = document.getElementById('files')
  let previews = document.getElementById('previews')

  fileInput.addEventListener('change', (evt) => {
    console.log(evt);

    let html = ''
    
    const files = fileInput.files;
    for (let file of files) {
      const url = URL.createObjectURL(file)
      html += 
      `<input type="radio" name="cover" value=${file.name}>
      <img src="${url}" width="100" height="150">`
    }

    previews.innerHTML = html
  })

  function hasFiles(fileInput) {
    return (fileInput.files.length > 0)
  }

  form.addEventListener('submit', (e) => {
    e.preventDefault()
    const form = new FormData(e.srcElement)

    if (!hasFiles(fileInput)) {
      alert('no hay archivos');
      form.delete('photo');
    }

    fetch('/admin/articulo', 
      {
        method: 'POST',
        body: form
      }
    )
    .then((res) => res.json())
    .then((json) => 
      {
        console.log<(JSON.stringify(json));
      }
    );
  });
</script>